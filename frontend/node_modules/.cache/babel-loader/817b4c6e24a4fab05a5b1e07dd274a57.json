{"ast":null,"code":"import { resetCallDataStateInitiate, setCallerUsernameInitiate, setCallingDialogVisibleInitiate, setCallStateInitiate, setLocalStreamInitiate } from \"../../Redux/Action/ActionCall\";\nimport { preOfferAnswers, defaultConstrains, configuration, callStates } from \"../ShareData\";\nimport store from \"../../Redux/Store\";\nimport * as wss from \"../Connect-Soket/wssConnection\";\nlet connectedUserSocketId;\nlet peerConnection;\nlet dataChannel;\nlet screenSharingStream; //Get Camera\n\nexport const getLocalStream = () => {\n  navigator.mediaDevices.getUserMedia(defaultConstrains).then(stream => {\n    store.dispatch(setLocalStreamInitiate(stream));\n    store.dispatch(setCallStateInitiate(callStates.CALL_AVAILABLE)); // createPeerConnection();\n  }).catch(err => {\n    console.log(\"error occured when trying to get an access to get local stream\");\n    console.log(err);\n  });\n}; //Call\n\nexport const handlePreOffer = data => {\n  if (checkIfCallIsPossible()) {\n    connectedUserSocketId = data.callerSocketId;\n    store.dispatch(setCallerUsernameInitiate(data.callerUsername));\n    store.dispatch(setCallStateInitiate(callStates.CALL_REQUESTED));\n  } else {\n    wss.sendPreOfferAnswer({\n      callerSocketId: data.callerSocketId,\n      answer: preOfferAnswers.CALL_NOT_AVAILABLE\n    });\n  }\n}; //accept call\n\nexport const acceptIncomingCallRequest = () => {\n  wss.sendPreOfferAnswer({\n    callerSocketId: connectedUserSocketId,\n    answer: preOfferAnswers.CALL_ACCEPTED\n  });\n  store.dispatch(setCallStateInitiate(callStates.CALL_IN_PROGRESS));\n}; //reject call\n\nexport const rejectIncomingCallRequest = () => {\n  wss.sendPreOfferAnswer({\n    callerSocketId: connectedUserSocketId,\n    answer: preOfferAnswers.CALL_REJECTED\n  });\n  resetCallData();\n};\nexport const callToOtherUser = calleeDetails => {\n  connectedUserSocketId = calleeDetails.socketId;\n  store.dispatch(setCallerUsernameInitiate(callStates.CALL_IN_PROGRESS));\n  store.dispatch(setCallingDialogVisibleInitiate({\n    data: true\n  }));\n  wss.sendPreOffer({\n    callee: calleeDetails,\n    caller: {\n      username: calleeDetails.username\n    }\n  });\n};\nexport const checkIfCallIsPossible = () => {\n  if (store.getState().call.localStream === null || store.getState().call.callState !== callStates.CALL_AVAILABLE) {\n    return false;\n  } else {\n    return true;\n  }\n}; //Function Reject\n\nexport const resetCallData = () => {\n  connectedUserSocketId = null;\n  store.dispatch(setCallStateInitiate(callStates.CALL_AVAILABLE));\n}; //show dialog\n\nexport const hangUp = () => {\n  wss.sendUserHangedUp({\n    connectedUserSocketId: connectedUserSocketId\n  });\n  resetCallDataAfterHangUp();\n};\n\nconst resetCallDataAfterHangUp = () => {\n  peerConnection.close();\n  peerConnection = null;\n  createPeerConnection();\n  resetCallData();\n  const localStream = store.getState().call.localStream;\n  localStream.getVideoTracks()[0].enabled = true;\n  localStream.getAudioTracks()[0].enabled = true;\n\n  if (store.getState().call.screenSharingActive) {\n    screenSharingStream.getTracks().forEach(track => {\n      track.stop();\n    });\n  }\n\n  store.dispatch(resetCallDataStateInitiate());\n};","map":{"version":3,"names":["resetCallDataStateInitiate","setCallerUsernameInitiate","setCallingDialogVisibleInitiate","setCallStateInitiate","setLocalStreamInitiate","preOfferAnswers","defaultConstrains","configuration","callStates","store","wss","connectedUserSocketId","peerConnection","dataChannel","screenSharingStream","getLocalStream","navigator","mediaDevices","getUserMedia","then","stream","dispatch","CALL_AVAILABLE","catch","err","console","log","handlePreOffer","data","checkIfCallIsPossible","callerSocketId","callerUsername","CALL_REQUESTED","sendPreOfferAnswer","answer","CALL_NOT_AVAILABLE","acceptIncomingCallRequest","CALL_ACCEPTED","CALL_IN_PROGRESS","rejectIncomingCallRequest","CALL_REJECTED","resetCallData","callToOtherUser","calleeDetails","socketId","sendPreOffer","callee","caller","username","getState","call","localStream","callState","hangUp","sendUserHangedUp","resetCallDataAfterHangUp","close","createPeerConnection","getVideoTracks","enabled","getAudioTracks","screenSharingActive","getTracks","forEach","track","stop"],"sources":["D:/Full-Stack-Developer/Call-Video-FullStack/frontend/src/Utils/WebRTCHandler/WebRTCHandler.js"],"sourcesContent":["import {\r\n  resetCallDataStateInitiate,\r\n  setCallerUsernameInitiate,\r\n  setCallingDialogVisibleInitiate,\r\n  setCallStateInitiate,\r\n  setLocalStreamInitiate,\r\n} from \"../../Redux/Action/ActionCall\";\r\nimport {\r\n  preOfferAnswers,\r\n  defaultConstrains,\r\n  configuration,\r\n  callStates,\r\n} from \"../ShareData\";\r\nimport store from \"../../Redux/Store\";\r\nimport * as wss from \"../Connect-Soket/wssConnection\";\r\nlet connectedUserSocketId;\r\nlet peerConnection;\r\nlet dataChannel;\r\nlet screenSharingStream;\r\n\r\n//Get Camera\r\nexport const getLocalStream = () => {\r\n  navigator.mediaDevices\r\n    .getUserMedia(defaultConstrains)\r\n    .then((stream) => {\r\n      store.dispatch(setLocalStreamInitiate(stream));\r\n      store.dispatch(setCallStateInitiate(callStates.CALL_AVAILABLE));\r\n      // createPeerConnection();\r\n    })\r\n    .catch((err) => {\r\n      console.log(\r\n        \"error occured when trying to get an access to get local stream\"\r\n      );\r\n      console.log(err);\r\n    });\r\n};\r\n//Call\r\nexport const handlePreOffer = (data) => {\r\n  if (checkIfCallIsPossible()) {\r\n    connectedUserSocketId = data.callerSocketId;\r\n    store.dispatch(setCallerUsernameInitiate(data.callerUsername));\r\n    store.dispatch(setCallStateInitiate(callStates.CALL_REQUESTED));\r\n  } else {\r\n    wss.sendPreOfferAnswer({\r\n      callerSocketId: data.callerSocketId,\r\n      answer: preOfferAnswers.CALL_NOT_AVAILABLE,\r\n    });\r\n  }\r\n};\r\n//accept call\r\nexport const acceptIncomingCallRequest = () => {\r\n  wss.sendPreOfferAnswer({\r\n    callerSocketId: connectedUserSocketId,\r\n    answer: preOfferAnswers.CALL_ACCEPTED,\r\n  });\r\n\r\n  store.dispatch(setCallStateInitiate(callStates.CALL_IN_PROGRESS));\r\n};\r\n//reject call\r\nexport const rejectIncomingCallRequest = () => {\r\n  wss.sendPreOfferAnswer({\r\n    callerSocketId: connectedUserSocketId,\r\n    answer: preOfferAnswers.CALL_REJECTED,\r\n  });\r\n  resetCallData();\r\n};\r\nexport const callToOtherUser = (calleeDetails) => {\r\n  connectedUserSocketId = calleeDetails.socketId;\r\n  store.dispatch(setCallerUsernameInitiate(callStates.CALL_IN_PROGRESS));\r\n  store.dispatch(setCallingDialogVisibleInitiate({ data: true }));\r\n\r\n  wss.sendPreOffer({\r\n    callee: calleeDetails,\r\n    caller: {\r\n      username: calleeDetails.username,\r\n    },\r\n  });\r\n};\r\nexport const checkIfCallIsPossible = () => {\r\n  if (\r\n    store.getState().call.localStream === null ||\r\n    store.getState().call.callState !== callStates.CALL_AVAILABLE\r\n  ) {\r\n    return false;\r\n  } else {\r\n    return true;\r\n  }\r\n};\r\n//Function Reject\r\nexport const resetCallData = () => {\r\n  connectedUserSocketId = null;\r\n  store.dispatch(setCallStateInitiate(callStates.CALL_AVAILABLE));\r\n};\r\n//show dialog\r\nexport const hangUp = () => {\r\n  wss.sendUserHangedUp({\r\n    connectedUserSocketId: connectedUserSocketId,\r\n  });\r\n\r\n  resetCallDataAfterHangUp();\r\n};\r\nconst resetCallDataAfterHangUp = () => {\r\n  peerConnection.close();\r\n  peerConnection = null;\r\n  createPeerConnection();\r\n  resetCallData();\r\n\r\n  const localStream = store.getState().call.localStream;\r\n  localStream.getVideoTracks()[0].enabled = true;\r\n  localStream.getAudioTracks()[0].enabled = true;\r\n\r\n  if (store.getState().call.screenSharingActive) {\r\n    screenSharingStream.getTracks().forEach((track) => {\r\n      track.stop();\r\n    });\r\n  }\r\n\r\n  store.dispatch(resetCallDataStateInitiate());\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}